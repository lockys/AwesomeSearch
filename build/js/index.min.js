$(document).ready(function(){function e(e,a){var t=e.split("/")[3],o=e.split("/")[4],n="https://api.github.com/repos/"+t+"/"+o+"/readme";$.ajax({url:n,headers:{accept:"application/vnd.github.v3.html"},success:a})}function a(e){var a=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return a.test(e)}var t,o,n=!0,r=!1,s={keys:["name"]},l=$(".awesome-block"),c=$(".search-result"),i=$(".mui-dropdown__menu"),h=$(".mui-dropdown"),m=function(m,p){var u="awesome";if(o=[],r="awesome"===p?1:0,n=!r,jsonURL=r?"https://raw.githubusercontent.com/lockys/awesome.json/master/awesome/awesome.json":"https://raw.githubusercontent.com/lockys/awesome.json/master/output/"+p+".json",h.removeClass("content-hidden"),c.addClass("content-hidden"),l.html(""),c.html(""),i.html(""),$(".alert").html(""),$(".awesome-input").val(""),r)l.html("Please wait a moment, it won't take long."),$(".search-holder").html("Search the awesome world."),$(".cate").html(u),l.removeClass("awesome-background");else{var d=m.url,f='<a href="'+d+'" target="_blank">Go To Original Repo</a><br/><br/>';u=m.name,$(".cate").html(u),l.html("Retrieving repo..."),e(d,function(e){l.html("").append(f).append(e);for(var t,o=$("h6 a, h5 a, h4 a, h3 a, h2 a, h1 a"),n=d.split("/")[3],r=d.split("/")[4],s="https://raw.githubusercontent.com/"+n+"/"+r+"/master/",c="style=",h=$("img"),m=0,p=h.length;p>m;++m){var u=$(h[m]).attr("src");a(u)||$(h[m]).attr("src",s+u)}for(var m=0,p=o.length;p>m;++m)o[m].id=o[m].id.replace("user-content-",""),c="style=",o[m].id&&(t=$(o[m]).parent()[0].nodeName,"H1"===t?c+='"font-size: 18px;"':"H2"===t?c+='"font-size: 16px; color:#3C3C3C;"':"H3"===t?c+='"font-size: 14px; color:#7B7B7B;"':"H4"===t?c+='"font-size: 12px; color:#ADADAD;"':"H5"===t?c+='"font-size: 12px; color:#D9006C;"':"H6"===t&&(c+='"font-size: 12px; color:#EA0000;"'),i.append("<li><a "+c+' href="#'+o[m].id+'">'+$(o[m]).parent("h6, h5, h4, h3, h2, h1").text()+"</a></li>"))}),l.addClass("awesome-background")}$.getJSON(jsonURL,function(e){var a=e;if(r)l.html(""),Object.keys(a).forEach(function(e){var t=e.replace(/\W/g,"").toLowerCase(),n='<h2 id="'+t+'">'+e+"</h2>";o=o.concat(a[e]),i.append('<li><a href="#'+t+'">'+e+"</a></li>"),l.append(n),a[e].forEach(function(e){var a=e.name.replace(/\W/g,"").toLowerCase(),t="",o=e.description?" - "+e.description:"";t='<a class="mui-btn mui-btn--small mui-btn--primary '+a+'" href="#repos/'+a+'" data-url="'+e.url+'" data-name="'+e.name+'"><span class="mui--text-white" data-url="'+e.url+'" data-name="'+e.name+'">'+e.name+'</span><span style="color: #7CF1F7" class="" data-url="'+e.url+'" data-name="'+e.name+'">'+o+"</span></a>",l.append(t)})});else{if(0===Object.keys(a).length)return n=!1,void $(".alert").html('<span style="color: red;">This repo has not been parsed yet, so what you search is awesome repo</span><br/>');a.forEach(function(e){o=o.concat(e)})}t=new Fuse(o,s)})};$(".awesome-input").on("input",function(e){var a=$(this).val(),o=20;c.removeClass("content-hidden"),c.html(""),a||c.addClass("content-hidden");var s=t.search(a),l="";s.length||c.html("No result :(");for(var i=0,h=o;h>i;++i)if(s[i]){var m=s[i].name.replace(/\W/g,"").toLowerCase(),p=' href="'+s[i].url+'" ';r&&(p=""),l=s[i].description?" - "+s[i].description+"</br>":"<br/>",n?c.append('<a class="'+m+' search-repo-link"'+p+'data-url="'+s[i].url+'" data-name="'+s[i].name+'" target="_blank">'+s[i].name+"</a>"+l):c.append('<a class="'+m+' search-repo-link" data-url="'+s[i].url+'" data-name="'+s[i].name+'" href="#/repos/'+m+'">'+s[i].name+"</a>"+l)}}),$("body").click(function(e){$(e.target).is(".back-button")&&(e.preventDefault(),window.location.hash="/",m(null,"awesome"))}),$(".to-top-arrow").click(function(){return $("html, body").animate({scrollTop:0},600),!1});var p=Backbone.Router.extend({routes:{"repos/:cate":"getRepos"}}),u=new p;u.on("route:getRepos",function(e){function a(a){for(var o=Object.keys(a),n=0,r=o.length;r>n;++n)if(o[n].replace(/\W/g,"").toLowerCase()===e){t={name:o[n],url:a[o[n]]},$(".search-holder").html("Search the "+t.name),m(t,e);break}}var t={},o="https://raw.githubusercontent.com/lockys/awesome.json/master/name-map/awesome.json";$.getJSON(o,a)}),Backbone.history.start(),m(null,"awesome")});