$(document).ready(function(){function e(e,a){var t=e.split("/")[3],n=e.split("/")[4],r="https://api.github.com/repos/"+t+"/"+n+"/readme";$.ajax({url:r,headers:{accept:"application/vnd.github.v3.html"},success:a})}function a(e){var a=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return a.test(e)}var t,n,r=!0,o=!1,s="https://raw.githubusercontent.com/lockys/awesome.json/master/name-map/awesome.json",l={keys:["name"]},i=$(".awesome-block"),c=$(".search-result"),m=$(".mui-dropdown__menu"),h=$(".mui-dropdown"),p=function(s,p){var u="awesome";if(o="awesome"===p?1:0,r=!o,jsonURL=o?"https://raw.githubusercontent.com/lockys/awesome.json/master/awesome/awesome.json":"https://raw.githubusercontent.com/lockys/awesome.json/master/output/"+p+".json",h.removeClass("content-hidden"),c.addClass("content-hidden"),i.html(""),c.html(""),m.html(""),$(".alert").html(""),$(".awesome-input").val(""),o)i.html("Please wait a moment, it won't take long."),$(".search-holder").html("Search the awesome world."),$(".cate").html(u),i.removeClass("awesome-background");else{var d=s.url,f='<a href="'+d+'" target="_blank">Go To Original Repo</a><br/><br/>';u=s.name,$(".cate").html(u),i.html("Retrieving repo..."),e(d,function(e){i.html("").append(f).append(e);for(var t,n=$("h6 a, h5 a, h4 a, h3 a, h2 a, h1 a"),r=d.split("/")[3],o=d.split("/")[4],s="https://raw.githubusercontent.com/"+r+"/"+o+"/master/",l="style=",c=$("img"),h=0,p=c.length;p>h;++h){var u=$(c[h]).attr("src");a(u)||$(c[h]).attr("src",s+u)}for(var h=0,p=n.length;p>h;++h)n[h].id=n[h].id.replace("user-content-",""),l="style=",n[h].id&&(t=$(n[h]).parent()[0].nodeName,"H1"===t?l+='"font-size: 18px;"':"H2"===t?l+='"font-size: 16px; color:#3C3C3C;"':"H3"===t?l+='"font-size: 14px; color:#7B7B7B;"':"H4"===t?l+='"font-size: 12px; color:#ADADAD;"':"H5"===t?l+='"font-size: 12px; color:#D9006C;"':"H6"===t&&(l+='"font-size: 12px; color:#EA0000;"'),m.append("<li><a "+l+' href="#'+n[h].id+'">'+$(n[h]).parent("h6, h5, h4, h3, h2, h1").text()+"</a></li>"))}),i.addClass("awesome-background")}$.getJSON(jsonURL,function(e){var a=e;if(n=[],o)i.html(""),Object.keys(a).forEach(function(e){var t=e.replace(/\W/g,"").toLowerCase(),r='<h2 id="'+t+'">'+e+"</h2>";n=n.concat(a[e]),m.append('<li><a href="#'+t+'">'+e+"</a></li>"),i.append(r),a[e].forEach(function(e){var a=e.name.replace(/\W/g,"").toLowerCase(),t="";e.description?" - "+e.description:"";t=e.url.split("/").indexOf("github.com")>-1?'<a class="mui-btn mui-btn--small mui-btn--primary '+a+'" href="#repos/'+a+'" data-url="'+e.url+'" data-name="'+e.name+'"><span class="mui--text-white" data-url="'+e.url+'" data-name="'+e.name+'">'+e.name+"</span></a>":'<a class="mui-btn mui-btn--small mui-btn--primary '+a+'" href="'+e.url+'" data-name="'+e.name+'" target="_blank"><span class="mui--text-white" data-url="'+e.url+'" data-name="'+e.name+'">'+e.name+"</span></a>",i.append(t)})});else{if(0===Object.keys(a).length)return r=!1,void $(".alert").html('<span style="color: red;">This repo has not been parsed yet, so what you search is awesome repo</span><br/>');a.forEach(function(e){n=n.concat(e)})}t=new Fuse(n,l)})};$(".awesome-input").on("input",function(e){var a=$(this).val(),n=15;c.removeClass("content-hidden"),c.html(""),a||c.addClass("content-hidden");var s=t.search(a),l="";s.length||c.html("No result :(");for(var i=0,m=n;m>i;++i)if(s[i]){var h=s[i].name.replace(/\W/g,"").toLowerCase(),p=' href="'+s[i].url+'" ';o&&(p=""),l=s[i].description?" - "+s[i].description+"</br>":"<br/>",r?c.append('<a class="'+h+' search-repo-link"'+p+'data-url="'+s[i].url+'" data-name="'+s[i].name+'" target="_blank">'+s[i].name+"</a>"+l):s[i].url.split("/").indexOf("github.com")>-1?c.append('<a class="'+h+' search-repo-link" data-url="'+s[i].url+'" data-name="'+s[i].name+'" href="#/repos/'+h+'">'+s[i].name+"</a>"+l):c.append('<a class="'+h+' search-repo-link" data-url="'+s[i].url+'" data-name="'+s[i].name+'" href="'+s[i].url+'" target="_blank">'+s[i].name+"</a>"+l)}}),$("body").click(function(e){$(e.target).is(".back-button")&&(e.preventDefault(),window.location.hash="/",p(null,"awesome"))}),$(".to-top-arrow").click(function(){return $("html, body").animate({scrollTop:0},600),!1});var u=Backbone.Router.extend({routes:{"repos/:cate":"getRepos","":"getAwesome"}}),d=new u;d.on("route:getRepos",function(e){var a={};$.getJSON(s,function(t){for(var n=t,r=Object.keys(n),o=0,s=r.length;s>o;++o)if(r[o].replace(/\W/g,"").toLowerCase()===e){a={name:r[o],url:n[r[o]]},$(".search-holder").html("Search the "+a.name),p(a,e);break}})}),d.on("route:getAwesome",function(){p(null,"awesome")}),Backbone.history.start()});