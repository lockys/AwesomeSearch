$(document).ready(function(){function e(e,a){var t=e.split("/")[3],n=e.split("/")[4],r="https://api.github.com/repos/"+t+"/"+n+"/readme";$.ajax({url:r,headers:{accept:"application/vnd.github.v3.html"},success:a})}function a(e){var a=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return a.test(e)}var t,n,r=!0,o=!1,s={keys:["name"]},l=$(".awesome-block"),i=$(".search-result"),c=$(".mui-dropdown__menu"),m=$(".mui-dropdown"),h=function(h,p){var u="awesome";if(n=[],o="awesome"===p?1:0,r=!o,jsonURL=o?"https://raw.githubusercontent.com/lockys/awesome.json/master/awesome/awesome.json":"https://raw.githubusercontent.com/lockys/awesome.json/master/output/"+p+".json",m.removeClass("content-hidden"),i.addClass("content-hidden"),l.html(""),i.html(""),c.html(""),$(".alert").html(""),$(".awesome-input").val(""),o)l.html("Please wait a moment, it won't take long."),$(".search-holder").html("Search the awesome world."),$(".cate").html(u),l.removeClass("awesome-background");else{var d=h.url,f='<a href="'+d+'" target="_blank">Go To Original Repo</a><br/><br/>';u=h.name,$(".cate").html(u),l.html("Retrieving repo..."),e(d,function(e){l.html("").append(f).append(e);for(var t,n=$("h6 a, h5 a, h4 a, h3 a, h2 a, h1 a"),r=d.split("/")[3],o=d.split("/")[4],s="https://raw.githubusercontent.com/"+r+"/"+o+"/master/",i="style=",m=$("img"),h=0,p=m.length;p>h;++h){var u=$(m[h]).attr("src");a(u)||$(m[h]).attr("src",s+u)}for(var h=0,p=n.length;p>h;++h)n[h].id=n[h].id.replace("user-content-",""),i="style=",n[h].id&&(t=$(n[h]).parent()[0].nodeName,"H1"===t?i+='"font-size: 18px;"':"H2"===t?i+='"font-size: 16px; color:#3C3C3C;"':"H3"===t?i+='"font-size: 14px; color:#7B7B7B;"':"H4"===t?i+='"font-size: 12px; color:#ADADAD;"':"H5"===t?i+='"font-size: 12px; color:#D9006C;"':"H6"===t&&(i+='"font-size: 12px; color:#EA0000;"'),c.append("<li><a "+i+' href="#'+n[h].id+'">'+$(n[h]).parent("h6, h5, h4, h3, h2, h1").text()+"</a></li>"))}),l.addClass("awesome-background")}$.getJSON(jsonURL,function(e){var a=e;if(o)l.html(""),Object.keys(a).forEach(function(e){var t=e.replace(/\W/g,"").toLowerCase(),r='<h2 id="'+t+'">'+e+"</h2>";n=n.concat(a[e]),c.append('<li><a href="#'+t+'">'+e+"</a></li>"),l.append(r),a[e].forEach(function(e){var a=e.name.replace(/\W/g,"").toLowerCase(),t="";e.description?" - "+e.description:"";t=e.url.split("/").indexOf("github.com")>-1?'<a class="mui-btn mui-btn--small mui-btn--primary '+a+'" href="#repos/'+a+'" data-url="'+e.url+'" data-name="'+e.name+'"><span class="mui--text-white" data-url="'+e.url+'" data-name="'+e.name+'">'+e.name+"</span></a>":'<a class="mui-btn mui-btn--small mui-btn--primary '+a+'" href="'+e.url+'" data-name="'+e.name+'" target="_blank"><span class="mui--text-white" data-url="'+e.url+'" data-name="'+e.name+'">'+e.name+"</span></a>",l.append(t)})});else{if(0===Object.keys(a).length)return r=!1,void $(".alert").html('<span style="color: red;">This repo has not been parsed yet, so what you search is awesome repo</span><br/>');a.forEach(function(e){n=n.concat(e)})}t=new Fuse(n,s)})};$(".awesome-input").on("input",function(e){var a=$(this).val(),n=20;i.removeClass("content-hidden"),i.html(""),a||i.addClass("content-hidden");var s=t.search(a),l="";s.length||i.html("No result :(");for(var c=0,m=n;m>c;++c)if(s[c]){var h=s[c].name.replace(/\W/g,"").toLowerCase(),p=' href="'+s[c].url+'" ';o&&(p=""),l=s[c].description?" - "+s[c].description+"</br>":"<br/>",r?i.append('<a class="'+h+' search-repo-link"'+p+'data-url="'+s[c].url+'" data-name="'+s[c].name+'" target="_blank">'+s[c].name+"</a>"+l):s[c].url.split("/").indexOf("github.com")>-1?i.append('<a class="'+h+' search-repo-link" data-url="'+s[c].url+'" data-name="'+s[c].name+'" href="#/repos/'+h+'">'+s[c].name+"</a>"+l):i.append('<a class="'+h+' search-repo-link" data-url="'+s[c].url+'" data-name="'+s[c].name+'" href="'+s[c].url+'" target="_blank">'+s[c].name+"</a>"+l)}}),$("body").click(function(e){$(e.target).is(".back-button")&&(e.preventDefault(),window.location.hash="/",h(null,"awesome"))}),$(".to-top-arrow").click(function(){return $("html, body").animate({scrollTop:0},600),!1});var p=Backbone.Router.extend({routes:{"repos/:cate":"getRepos"}}),u=new p;u.on("route:getRepos",function(e){function a(a){for(var n=Object.keys(a),r=0,o=n.length;o>r;++r)if(n[r].replace(/\W/g,"").toLowerCase()===e){t={name:n[r],url:a[n[r]]},$(".search-holder").html("Search the "+t.name),h(t,e);break}}var t={},n="https://raw.githubusercontent.com/lockys/awesome.json/master/name-map/awesome.json";$.getJSON(n,a)}),Backbone.history.start(),h(null,"awesome")});